# 英語学習アプリ 要件定義書（最新版）

## 1. 概要
- ニュース記事を題材に、AI（英語教師）とユーザーがチャット形式で英語学習を行うアプリ。
- 設問（要約・語彙・読解・ディスカッション）にAIが出題・評価し、最後にサマリーを生成。

---

## 2. 画面構成

### 2.1 ホーム画面
- ニュース記事の選択・入力

### 2.2 レッスン画面（チャットUI）
- 上部：選択した記事の表示
- 下部：AIとユーザーのチャットインターフェース

#### チャットUIの仕様
- **AIメッセージ**  
  - 左側に「先生アイコン（public/teacher-avatar.png）」を丸型で表示
  - バブル内に「AI: ...」のテキスト
  - アイコンは`<img src="./teacher-avatar.png" ... />`で表示、サイズ40x40px、丸型、青枠
- **ユーザーメッセージ**  
  - 右側に「ユーザーアイコン（public/user.png）」を丸型で表示
  - バブル内に「あなた: ...」のテキスト
  - アイコンは`<img src="./user.png" ... />`で表示、サイズ40x40px、丸型、灰色枠
- **AIフィードバック**  
  - AIアイコン（先生アイコン）＋緑色バブルでスコア・アドバイス等を表示
- **バブルデザイン**  
  - 各メッセージは吹き出し（バブル）で表示
  - AIは左寄せ、ユーザーは右寄せ

---

## 3. 設問・評価・サマリー

### 3.1 設問生成
- 記事からAIが一括で設問（要約・語彙2問・読解2問・ディスカッション）をJSON形式で生成

### 3.2 回答・評価
- ユーザーが各設問に回答
- AIがJSON形式でスコア・フィードバック・模範解答等を返す

### 3.3 サマリー生成
- 全設問終了後、「Summary」ボタンでAIがサマリーを生成
- サマリーはJSON形式で、学んだ語彙・フレーズ（英語＋日本語訳5つ）、良かった点、改善点、アドバイスを含む

---

## 4. ファイル・画像仕様

- 先生アイコン画像：`public/teacher-avatar.png`
  - 丸型、40x40px、青枠
- ユーザーアイコン画像：`public/user.png`
  - 丸型、40x40px、灰色枠
- 画像は`object-cover`で中央トリミング
- 画像参照は相対パス（`./teacher-avatar.png`、`./user.png`）

---

## 5. 技術仕様

- React + Electron + Vite構成
- 画像は`public`配下に配置し、ビルド後は`dist/renderer`配下にコピーされる
- チャットUIは`src/pages/Lesson.tsx`で実装
- バブル・アイコンのレイアウトはFlexboxで制御

---

## 6. 補足

- 画像が表示されない場合は、ビルド後の`dist/renderer`配下に画像がコピーされているか、パスが相対パスになっているかを確認
- サーバー起動・ビルド手順はREADME参照

---

## 7. ユーザー履歴管理・保存仕様（新規追加）

### 7.1 保存対象データ
- 各レッスンごとに以下を1セットとして保存する
  - 記事本文（使用したニュース記事の内容）
  - 設問内容（AIが生成した全設問のJSON）
  - ユーザーの全回答
  - AIの全フィードバック（スコア・アドバイス等）
  - サマリーページに表示された内容（学んだ語彙・フレーズ、良かった点、改善点、アドバイス等）
  - レッスン実施日時（ISO8601形式などで記録）

### 7.2 保存方法
- ローカルストレージ（例：localStorage、IndexedDB、ファイル保存など）にJSON形式で保存
- 各レッスンは一意なID（例：タイムスタンプやUUID）で管理し、履歴一覧を時系列で取得可能にする

### 7.3 取得・活用
- 履歴一覧を時系列で取得し、過去のレッスン内容・スコア・学んだ語彙などを参照できる
- 今後の分析（進捗グラフ、語彙の定着度、苦手・得意分野の可視化等）に活用できるよう、データ構造を拡張可能に設計

### 7.4 データ例
```json
{
  "lessonId": "2024-05-01T12:34:56.789Z",
  "timestamp": "2024-05-01T12:34:56.789Z",
  "article": "（記事本文）",
  "questions": { ... },
  "answers": [
    { "questionType": "summary", "answer": "...", "feedback": {...} },
    { "questionType": "vocab", "answer": "...", "feedback": {...} },
    ...
  ],
  "summary": {
    "vocab_phrases": [...],
    "praise": "...",
    "improvement": "...",
    "advice": "..."
  }
}
```

### 7.5 実装メモ
- 保存・取得のAPIは`src/utils/history.ts`などにまとめる
- 保存タイミングはサマリーページ表示時（`setSummaryData`時）を推奨
- データ肥大化を防ぐため、古い履歴の削除やエクスポート機能も将来的に検討

---

## 8. PWA対応・デプロイ・API切り替え・今後の運用

### 8.1 PWA対応・Vercelデプロイ
- 本アプリはElectron版とPWA（Web）版の両方をサポート
- PWA版はVercel等のホスティングサービスでデプロイ可能
- service-worker.jsはpublic配下に配置し、PWAとして動作
- デプロイ手順やPWA固有の注意点はREADME参照

### 8.2 API切り替え（OpenAI/Perplexity）
- AI APIはOpenAIとPerplexityの2種類をサポート
- .envファイルでAPIキーを管理
- `src/main.ts`でapiTypeを切り替え可能
- 設問生成・評価時のレスポンス形式はJSONスキーマで厳格に管理

### 8.3 共通ロジック分離・今後の運用
- Electron版・PWA版で共通化できるロジック（API通信・データ構造・履歴管理等）は`src/common`等に分離して管理する方針
- UIやプラットフォーム固有部分のみ個別に実装
- 新機能追加時は共通ロジック→各プラットフォームUIの順で実装・テスト
- 詳細な運用方針やディレクトリ構成例はREADME参照

ご要望・追加仕様があれば、随時追記・修正します。